<body>

    <p id="demo">Gramy w kółko i krzyżyk?</p>
    <form name="loginForm" action="" method="PUT">
        Provide username & password: <br>
        <input type="text" name="user_inputbox" value="adamg">
        <input type="password" name="password_inputbox" value="alamakota1">
        <input type="button" name="button" value="Login" onClick="loginResults(this.form)"> 
        ==> Token: 
        <input type="password" name="tokeninputbox" value="xp0jeffwml"> <label id="password_label"> </label>
      </form>
      <hr>
      <form name="ListGamesForm" action="" method="GET">
        List existing games you just started and waiting for someone to join (login required): <br>
        <input type="button" name="button" value="List games" onClick="listgamesResults(this.form)">
        <br>
        <br>
          <table id="lista_gier" style="width: 350" BORDER="1">
            <th style="width: 30; height: 30" align="center" bgcolor="silver">ID</th>
            <th style="width: 70; height: 30" align="center" bgcolor="silver">Status</th>
            <th style="width: 30; height: 30" align="center" bgcolor="silver">Player1</th>
            <th style="width: 30; height: 30" align="center" bgcolor="silver">Player2</th>
            <th style="width: 40; height: 30" align="center" bgcolor="silver">Akcja</th>
        </table>
      </form>
    <hr>
      <form name="CreateGameForm" action="" method="POST">
        Create Game or join the existing game (login required): <br>
        <input type="button" name="button" value="Create" onClick="creategameResults(this.form)">
      </form>
    <hr>
      <form name="GetBoardForm" action="" method="GET">
        Get board => <!-- => token for login, game id: <br>
        <input type="text" name="gameidinputbox" value="13">
        <input type="button" name="button" value="Get game" onClick="getboardResults(this.form)">
        -->
        <label id="gameid_label"></label><br>
        <input size=1 type="button" name="refreshButton" value="Refresh!" onClick="refreshBoard(document.getElementById('gameid_label').innerText)">
        <div>
            <br>
            <table id="tabelka" style="width: 200" BORDER="1">
                <th style="width: 30; height: 30" align="center" bgcolor="silver">R\C</th>
                <th style="width: 30; height: 30" align="center" bgcolor="silver">0</th>
                <th style="width: 30; height: 30" align="center" bgcolor="silver">1</th>
                <th style="width: 30; height: 30" align="center" bgcolor="silver">2</th>
              <tr>
                <th bgcolor="silver">0</th>
                <td style="width: 30; height: 30" align="center" onmouseover="style.backgroundColor ='orange';doGetTableXY(0,0,tabelka.rows[1].cells[1].innerText)" onmouseout="style.backgroundColor ='white'" onClick="doMove(this.form)"> </td>
                <td style="width: 30; height: 30" align="center" onmouseover="style.backgroundColor ='orange';doGetTableXY(0,1,tabelka.rows[1].cells[1].innerText)" onmouseout="style.backgroundColor ='white'" onClick="doMove(this.form)"> </td>
                <td style="width: 30; height: 30" align="center" onmouseover="style.backgroundColor ='orange';doGetTableXY(0,2,tabelka.rows[1].cells[1].innerText)" onmouseout="style.backgroundColor ='white'" onClick="doMove(this.form)"> </td>
              </tr>
              <tr>
                <th bgcolor="silver">1</th>
                <td style="width: 30; height: 30" align="center"> </td>
                <td style="width: 30; height: 30" align="center"> </td>
                <td style="width: 30; height: 30" align="center"> </td>
              </tr>
              <tr>
                <th bgcolor="silver">2</th>
                <td style="width: 30; height: 30" align="center"> </td>
                <td style="width: 30; height: 30" align="center"> </td>
                <td style="width: 30; height: 30" align="center"> </td>
              </tr>
              <tr>
                <td colspan="4" align="center" ><label id="game_status"></label></td>
              </tr>
              <tr>
                <td colspan="4" align="center" ><label id="user1_label"></label></td>
              </tr>
              <tr>
                <td colspan="4" align="center" ><label id="user2_label"></label></td>
              </tr>
              <tr>
                <td colspan="4" align="center" ><label id="nextmove_label"></label></td>
              </tr>
              <tr>
                <th bgcolor="silver">Row</th>
                <td colspan="3" style="width: 30; height: 30" align="left"><input size=1 type="text" name="input_row" value="0"></td>
              </tr>
              <tr>
                <th bgcolor="silver">Col</th>
                <td colspan="3" style="width: 30; height: 30" align="left"><input size=1 type="text" name="input_col" value="0"></td>
              </tr>
              <tr>
                <td></td>
                <td colspan="3" style="width: 30; height: 30" align="left"><input size=1 type="button" name="moveButton" value="Move!" onClick="doMove(this.form)"></td>
              </tr>
            </table>
          </div>
          
      </form>
      <hr>
      <br>
      <form name="myForm" action="" method="GET">
        Token for login: <br>
        <input type="text" name="tokeninputbox" value="xp0jeffwml">
        <input type="button" name="button" value="Click" onClick="testResults(this.form)">
      </form>
    
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script>

            function loginResults (form) {
                const user = loginForm.user_inputbox.value;
                const password = form.password_inputbox.value;
                axios.post("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/account/login?", {
                     username: `${user}`, password:`${password}` })                
                .then(response =>{console.log(response.data.token);loginForm.tokeninputbox.value=response.data.token;
                    var x = document.getElementById("password_label");  
                    x.innerText="Pobrano token :-)"})
                .catch(error =>{console.error(error)});
                }


            function creategameResults (form) {
                const token = loginForm.tokeninputbox.value;
                
                axios.post("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/game/create", {} ,
                    {
                    headers: {
                        Authorization: 'Bearer ' + token //the token is a variable which holds the token
                    }})
                
                .then(response =>{console.log(response.data);})
                .catch(error =>{console.error(error)});
                }

            function listgamesResults (form) {
                
                const token = loginForm.tokeninputbox.value;
                axios.get("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/games", {
                    headers: {
                        Authorization: 'Bearer ' + token //the token is a variable which holds the token
                    }})
                
                .then(response =>{console.log(response.data);
                  console.log(response.data.length);
                  for(var i=0; i<response.data.length; i++){
                    console.log(response.data[i].id);
                  }
                  var table = document.getElementById('lista_gier');
                  var rowCount = table.rows.length;
                  var cellCount = table.rows[0].cells.length;
                  for(var i=rowCount-1; i>0; i--){
                    table.deleteRow(i);
                  } 
                  for(var i=0; i<response.data.length; i++){
                    var row = table.insertRow(i+1);
                    var cell = row.insertCell(0);
                    cell.innerText = response.data[i].id;
                    cell.style.textAlign = "center";
                    cell = row.insertCell(1);
                    cell.innerText = response.data[i].status;
                    cell.style.textAlign = "center";
                    cell = row.insertCell(2);
                    cell.innerText = response.data[i].user1;
                    cell.style.textAlign = "center";
                    cell = row.insertCell(3);
                    cell.innerText = response.data[i].user2;
                    cell.style.textAlign = "center";
                    if(response.data[i].status == "playing"){
                      cell = row.insertCell(4);
                      cell.style.textAlign = "center";
                      cell.innerHTML = '<input id="Button" type=\"button\" value="Graj!" onClick=\"getboardResults('+response.data[i].id+','+response.data[i].user1+','+response.data[i].user2+',\''+response.data[i].status+'\')"/>';
                      console.log(cell.innerHTML);
                    }
                    else {
                      cell = row.insertCell(4);
                      cell.innerText="";
                      cell.style.textAlign = "center";
                    }
                  }
                
                
                })
                .catch(error =>{console.error(error)});
                }
    
            function getboardResults (i_gameid, i_user1, i_user2, i_status) {


            
                
                const token = loginForm.tokeninputbox.value;
                const gameid = i_gameid;
                axios.get("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/board?gameid="+gameid, {
                    headers: {
                        Authorization: 'Bearer ' + token //the token is a variable which holds the token
                    }})
                
                .then(response =>{console.log(response.data);
                    //var table = form.tabelka;
                    var table = document.getElementById('tabelka');                                        
                    table.rows[1].cells[1].innerHTML = response.data.board.row1[0];
                    table.rows[1].cells[2].innerHTML = response.data.board.row1[1];
                    table.rows[1].cells[3].innerHTML = response.data.board.row1[2];
                    table.rows[2].cells[1].innerHTML = response.data.board.row2[0];
                    table.rows[2].cells[2].innerHTML = response.data.board.row2[1];
                    table.rows[2].cells[3].innerHTML = response.data.board.row2[2];
                    table.rows[3].cells[1].innerHTML = response.data.board.row3[0];
                    table.rows[3].cells[2].innerHTML = response.data.board.row3[1];
                    table.rows[3].cells[3].innerHTML = response.data.board.row3[2];
                    var x = document.getElementById("game_status");  
                    x.innerText="Status: " + response.data.status;
                    x = document.getElementById("user1_label");  
                    x.innerText="Player1: " + i_user1;
                    x = document.getElementById("user2_label");  
                    x.innerText="Player2: " + i_user2;
                    x = document.getElementById("gameid_label");  
                    x.innerText=i_gameid;
                })
                .catch(error =>{console.error(error)});

                axios.get("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/checknextmove?gameid="+gameid, {
                    headers: {
                        Authorization: 'Bearer ' + token //the token is a variable which holds the token
                    }})
                
                .then(response =>{console.log(response.data);
                    var x = document.getElementById("nextmove_label");  
                    x.innerText="Twój ruch? " + (response.data == true ? "TAK" : "NIE");
                    if (response.data == true) callJakaGramFigura(token, gameid);
                })
                .catch(error =>{console.error(error)});
                }


                
    
            function refreshBoard(i_gameid) {
              const token = loginForm.tokeninputbox.value;
              const gameid = i_gameid;
              axios.get("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/board?gameid="+gameid, {
                  headers: {
                      Authorization: 'Bearer ' + token //the token is a variable which holds the token
                  }})

              .then(response =>{console.log(response.data);
                  //var table = form.tabelka;
                  var table = document.getElementById('tabelka');                                        
                  table.rows[1].cells[1].innerHTML = response.data.board.row1[0];
                  table.rows[1].cells[2].innerHTML = response.data.board.row1[1];
                  table.rows[1].cells[3].innerHTML = response.data.board.row1[2];
                  table.rows[2].cells[1].innerHTML = response.data.board.row2[0];
                  table.rows[2].cells[2].innerHTML = response.data.board.row2[1];
                  table.rows[2].cells[3].innerHTML = response.data.board.row2[2];
                  table.rows[3].cells[1].innerHTML = response.data.board.row3[0];
                  table.rows[3].cells[2].innerHTML = response.data.board.row3[1];
                  table.rows[3].cells[3].innerHTML = response.data.board.row3[2];
                  var x = document.getElementById("game_status");  
                  x.innerText="Status: " + response.data.status;
              })
              .catch(error =>{console.error(error)});

              axios.get("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/checknextmove?gameid="+gameid, {
                  headers: {
                      Authorization: 'Bearer ' + token //the token is a variable which holds the token
                  }})

              .then(response =>{console.log(response.data);
                  var x = document.getElementById("nextmove_label");  
                  x.innerText="Twój ruch? " + (response.data == true ? "TAK" : "NIE");
                  if (response.data == true) callJakaGramFigura(token, gameid);
              })
              .catch(error =>{console.error(error)});
              }

            function callJakaGramFigura(token, gameid){
                console.log("sprawdzam figure");
                axios.get("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/checkmysymbolingame?gameid="+gameid, {
                    headers: {
                        Authorization: 'Bearer ' + token //the token is a variable which holds the token
                    }})
                
                .then(response =>{console.log(response.data);
                    var x = document.getElementById("nextmove_label");  
                    x.innerText=x.innerText + "("+ response.data+")";})
                .catch(error =>{console.error(error)});
            }
            
            function doMove(formularz){
              const token = loginForm.tokeninputbox.value;
                console.log("robimy ruch");

                const i_row = GetBoardForm.input_row.value;
                const i_col = GetBoardForm.input_col.value;
                var x = document.getElementById("gameid_label");  
                //const i_gameid = GetBoardForm.gameid_label.innerText;
                const i_gameid = x.innerText;
                     
                axios.post("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/move?gameid="+`${i_gameid}`+"&row="+`${i_row}`+"&col="+`${i_col}`, 
                    {},
                    { 
                    headers: {
                        Authorization: 'Bearer ' + token //the token is a variable which holds the token
                    }})
                
                .then(response =>{console.log(response.data);
                    })
                .catch(error =>{console.error(error);
                  console.log(error.response.data)});
            }
            

            function doGetTableXY(row,col,zawartosc){
                console.log("X="+row+ "Y="+col+" zawartosc->"+zawartosc+"<-");
                if (zawartosc=="") {
                  console.log("pusta kratka");
                  GetBoardForm.input_row.value=row;
                  GetBoardForm.input_col.value=col;
                }
                else {console.log("niepusta kratka")}

              
            }
            



            function testResults (form) {
                
            //axios.get("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/hello")
            const token = form.tokeninputbox.value;
            axios.get("https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/board?gameid=13", {data: null ,
                headers: {
                    Authorization: 'Bearer ' + token //the token is a variable which holds the token
                }})
            
            .then(response =>{console.log(response.data);})
            .catch(error =>{console.error(error)});
            }
    //    const axios = require('axios/dist/browser/axios.cjs');


/*
        const xhr = new XMLHttpRequest();
        //xhr.open("POST", "https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/move?gameid=13&row=2&col=2");
        xhr.open("GET", "https://kolkoikrzyzyksrv-dot-intense-dolphin-376811.uc.r.appspot.com/v1/hello");
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        const body = JSON.stringify({
            gameid: "13",
            row: "2",
            col: "2",
        });
        xhr.send(body);
        xhr.onload = () => {
        if (xhr.readyState == 4 && xhr.status == 201) {
            alert(JSON.parse(xhr.responseText));
        } else {
            alert(`Error: ${xhr.status}`);
        }
        };
        
        let d = new Date();
        //alert("Today's date is " + d);
        */
    </script>
    
</body>